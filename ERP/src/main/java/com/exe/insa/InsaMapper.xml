<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-/mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.exe.insa">

	<select id="buseolist" resultType="com.exe.insa.BuseoDTO">
		select buseoNum,depth1, depth2, depth3,depth4,depth5 from buseo
		order by depth1,depth2 ,depth3 , depth4 , depth5 			
	</select>
	
	<select id="depth1" resultType="com.exe.insa.BuseoDTO">
	select depth1 from buseo group by depth1 having count(*)>=1 and depth1!='0' order by depth1
	</select>
	
	<select id="depth1etc" resultType="com.exe.insa.BuseoDTO">
	select depth1 from buseo group by depth1 having count(*)>1 and depth1!='0' order by depth1
	</select>
	
	<select id="depth2" resultType="com.exe.insa.BuseoDTO">
		select depth2 from buseo group by depth2 having count(*)>=1 and depth2!='0' order by depth2
	</select>
	
	<select id="depth2etc" resultType="com.exe.insa.BuseoDTO">
		select depth2 from buseo group by depth2 having count(*)>1 and depth2!='0' order by depth2
	</select>
	
	<select id="depth3" resultType="com.exe.insa.BuseoDTO">
		select depth3 from buseo group by depth3 having count(*)>=1 and depth3!='0' order by depth3
	</select>
	
	<select id="depth3etc" resultType="com.exe.insa.BuseoDTO">
		select depth3 from buseo group by depth3 having count(*)>1 and depth3!='0' order by depth3
	</select>
	
	<select id="depth4" resultType="com.exe.insa.BuseoDTO">
		select depth4 from buseo group by depth4 having count(*)>=1 and depth4!='0' order by depth4
	</select>
	
	<select id="depth4etc" resultType="com.exe.insa.BuseoDTO">
		select depth4 from buseo group by depth4 having count(*)>1 and depth4!='0' order by depth4
	</select>
	
	
	<select id="depth5" resultType="com.exe.insa.BuseoDTO">
		select depth5 from buseo group by depth5 having count(*)>=1 and depth5!='0' order by depth5 
	</select>
	
	
	<!-- 새로 다시 짜기 시작 -->
	
	<!-- 부서 고유 번호 구하기  -->
	<select id="maxNum" resultType="integer">
	select nvl(max(buseoNum),0) from buseo	
	</select>
	
	<!-- 생성 -->
	<insert id="buseoCreated" parameterType="com.exe.insa.BuseoDTO">
	insert into buseo(buseoNum,groupNum,depth,orderNo,parent)
	values (#{buseoNum},#{groupNum},#{depth},#{orderNo},#{parent})
	
	</insert>
	
	<!-- 리스트출력 -->
	<select id="list" resultType="com.exe.insa.BuseoDTO">
	
	select buseoNum,buseoName,groupNum,depth,orderNo,parent,checked from buseo order by groupNum desc, orderNo asc
	
	</select>
	
	<!-- 하위 개수 -->
   <select id="replyNum" resultType="Integer" parameterType="map">
      select count(*) from buseo where groupNum=#{groupNum} and depth=#{depth}+1 and parent=#{buseoNum}
   </select>
   
   <!-- 하위갯수변경 -->
   <update id="setReplyNum" parameterType="map">
      update buseo set replyNum=#{replyNum} where buseoNum=#{buseoNum}
   </update>
	
	 <!-- 하위가 생길 경우 순서변경 -->
   <update id="orderNoUpdate" parameterType="map">
      update buseo set orderNo=orderNo + 1
      where groupNum=#{groupNum} and orderNo>#{orderNo}
   </update>
	
	<!-- 정보읽기 -->
	<select id="ReadData" parameterType="integer" resultType="com.exe.insa.BuseoDTO">
		select buseoNum,buseoName,groupNum,depth,orderNo,parent,replyNum,checked from buseo where buseoNum=#{buseoNum}
	
	</select>
	
	
	
	
	
</mapper>

